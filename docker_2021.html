<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="img/favicon.ico">
        <title>Development for Data Scientist: - AI Frameworks</title>
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <link href="css/font-awesome.min.css" rel="stylesheet">
        <link href="css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/docco.min.css">

        <script src="js/jquery-1.10.2.min.js" defer></script>
        <script src="js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="index.html">AI Frameworks</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="index.html" class="nav-link">Home</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Courses <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="introduction.html" class="dropdown-item">Course Introduction</a>
</li>
                                    
<li>
    <a href="git_intro.html" class="dropdown-item">Introduction to Git</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Development tools for Data Scientist</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="dev.html" class="dropdown-item">Python Scripts</a>
</li>
            
<li>
    <a href="gcloud_set_up.html" class="dropdown-item">Set up GCoud</a>
</li>
            
<li>
    <a href="gcloud.html" class="dropdown-item">Introduction to GCloud</a>
</li>
            
<li>
    <a href="docker.html" class="dropdown-item">Introduction to Docker</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Reinforcement Learning</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="rl.html" class="dropdown-item">Introduction to Reinforcement Learning</a>
</li>
            
<li>
    <a href="rl_quiz.html" class="dropdown-item">Reinforcement learning quizz</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Interpretability</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="interpretability.html" class="dropdown-item">Interpretability in Machine Learning</a>
</li>
            
<li>
    <a href="interpretability_quizz.html" class="dropdown-item">Interpretability quizz</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Natural language processing</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="nlp.html" class="dropdown-item">Introduction to Natural Language Processing (NLP)</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="schedule.html" class="nav-link">Schedule</a>
                            </li>
                            <li class="navitem">
                                <a href="evaluation.html" class="nav-link">Evaluation</a>
                            </li>
                            <li class="navitem">
                                <a href="https://github.com/wikistat/AI-Frameworks" class="nav-link">Github repository</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#development-for-data-scientist" class="nav-link">Development for Data Scientist:</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#docker" class="nav-link">Docker</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#course" class="nav-link">Course</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#practical-session" class="nav-link">Practical Session</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="development-for-data-scientist">Development for Data Scientist:</h1>
<h2 id="docker">Docker</h2>
<h2 id="course">Course</h2>
<iframe width="560" height="315" src="https://www.youtube.com/embed/loMf5bFyzY4" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<ul>
<li><a href="slides/Code_Development_Docker.pdf">Slides</a></li>
</ul>
<!-- *   [Practical session](https://github.com/wikistat/AI-Frameworks/blob/master/CodeDevelopment/TP.pdf) -->

<h2 id="practical-session">Practical Session</h2>
<p>In this practical session, you will now run your code through a Docker container.<br />
Using docker in data science projects has two advantages:
*   Improving the reproducibility of the results<br />
*   Facilitating the portability and deployment
In this session, we will try to package the code from the previous session, allowing us to train a neural network to colorize images into a Docker image and use this image to instantiate a container on a GCloud instance to run the code.</p>
<p>We will first create the Dockerfile corresponding to our environment.  </p>
<p>On your local machine, create a new file named <code>Dockerfile</code> containing the following code:</p>
<pre><code class="language-python"># Base image from pytorch
FROM pytorch/pytorch:1.7.1-cuda11.0-cudnn8-runtime
# Set up for your local zone an UTC information
ENV TZ=Europe/Paris
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime &amp;&amp; echo $TZ &gt; /etc/timezone
# Additional librairies
RUN pip install tqdm tensorboard
</code></pre>
<p>Take a moment to analyze this dockerfile.
As you can see, it is built upon an existing image from Pytorch.
Starting from existing images allows for fast prototyping. You may find existing images on <a href="https://hub.docker.com/">DockerHub</a>. The Pytorch image we will be using is available <a href="https://hub.docker.com/r/pytorch/pytorch">here</a></p>
<p>Fire up your GCloud instance and send your dockerfile using </p>
<pre><code class="language-console">gcloud compute scp [your_file_path] [your_instance_name]:Workspace/ --zone [your_instance_zone]
</code></pre>
<p>Connect to your instance:</p>
<pre><code class="language-console">gcloud compute ssh --zone [your_instance_zone] [your_instance_name]
</code></pre>
<p>If docker is not already installed in your machine, follow <a href="https://docs.docker.com/engine/install/">this guide</a> to install it.
You will also need the NVIDIA Container Toolkit to be installed to allow docker to communicate with the instance GPU.
If you created your GCloud instance following the previous session's instructions, it should be OK.
To verify that it is OK you may run the following command:</p>
<pre><code class="language-console">sudo docker run --rm --gpus all nvidia/cuda:11.0-base nvidia-smi
</code></pre>
<p>If the command output is in the form of :</p>
<pre><code class="language-console">+-----------------------------------------------------------------------------+
| NVIDIA-SMI 450.51.06    Driver Version: 450.51.06    CUDA Version: 11.0     |
|-------------------------------+----------------------+----------------------+
| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |
| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |
|                               |                      |               MIG M. |
|===============================+======================+======================|
|   0  Tesla T4            On   | 00000000:00:1E.0 Off |                    0 |
| N/A   34C    P8     9W /  70W |      0MiB / 15109MiB |      0%      Default |
|                               |                      |                  N/A |
+-------------------------------+----------------------+----------------------+

+-----------------------------------------------------------------------------+
| Processes:                                                                  |
|  GPU   GI   CI        PID   Type   Process name                  GPU Memory |
|        ID   ID                                                   Usage      |
|=============================================================================|
|  No running processes found                                                 |
+-----------------------------------------------------------------------------+
</code></pre>
<p>then everything is OK. Otherwise, you may need to install the NVIDIA Container Toolkit manually, following <a href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/install-guide.html#docker">this guide</a>.</p>
<p>You may now build your first image using the following command:</p>
<pre><code class="language-console">sudo docker build -t [your_image_name] -f [path_to_your_image]  [build_context_folder]
</code></pre>
<p>The image should take a few minutes to build.<br />
Once this is done, use the following command to list the available images on your GCloud instance:</p>
<pre><code class="language-console">sudo docker image ls
</code></pre>
<p>How many images can you see? What do they refer to?  </p>
<p>Now that our images are built, we can now use them to instantiate containers.
Since a container is an instance of an image, we can instantiate several containers using a single image.</p>
<p>We will run our first container using the interactive mode.</p>
<p>Run the following command to run your fist container:</p>
<pre><code class="language-console">docker run -it --name [your_container_name] [your_image_name]
</code></pre>
<p>You should now have access to an interactive terminal from your container.<br />
On this terminal, open a Python console and check that Pytorch is installed and has access to your instance GPU.</p>
<pre><code class="language-python">import torch
print(torch.cuda.is_available())
</code></pre>
<p>Quit the Python console and quit your container using <code>ctrl+d</code>.<br />
You can list all your running containers using the following command:</p>
<pre><code class="language-console">sudo docker container ls
</code></pre>
<p>Your container is closed and does not appear.
To list all the existing containers, add the <code>-a</code> to the previous command.</p>
<pre><code class="language-console">sudo docker container ls -a
</code></pre>
<p>Start your containers using:</p>
<pre><code class="language-console">sudo docker start [container_id_or_name]
</code></pre>
<p>Check that it is now listed as started.
You can have access to its interactive mode using the <code>attach</code> command:</p>
<pre><code class="language-console">sudo docker attach [container_id_or_name]
</code></pre>
<p>You can delete a container using the <code>rm</code> command:</p>
<pre><code class="language-console">sudo docker rm [container_id_or_name]
</code></pre>
<p>We will now see how to share data between the container and the machine it is running on.
First create a folder containing the files:
*   <code>download_landscapes.sh</code>
*   <code>unet.py</code>
*   <code>colorize.py</code>
*   <code>data_utils.py</code></p>
<p>Create a new container using this time mounting a shared volume using the following command:</p>
<pre><code class="language-console">docker run -it --name [container_name] -v ~/[your_folder_path]:/workspace/[folder_name] [image_name]
</code></pre>
<p>Go to the shared folder and run the <code>download_landscapes.sh</code> script.
Leave the container and look at your folder in the local. What can you see?</p>
<p>If you want to run your job using the interactive mode, you need to give access at your container to your host resources.</p>
<p>Start a new container using the following command to get access to the GPU and CPU resources and run the <code>colorize.py</code> script.</p>
<pre><code class="language-console">docker run -it --gpus all --ipc=host --name [container_name] -v ~/[your_folder_path]:/workspace/[folder_name] [image_name]
</code></pre>
<p>Now try to send all the results and weights to your local machine and maybe to look at the tensorboard logs.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = ".",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="js/base.js" defer></script>
        <script src="javascripts/mathjax.js" defer></script>
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6" defer></script>
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" defer></script>
        <script src="search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
